<!DOCTYPE html>
<!--
  ä½¿ã„æ–¹ (Usage)

  * ç¾åœ¨ã€hirokws.comã§ä¸€æ™‚çš„ã«å…¬é–‹ä¸­ã§ã™ã€‚ã€€

  - é€šå¸¸ãƒ¢ãƒ¼ãƒ‰: index.html ã‚’ãã®ã¾ã¾é–‹ãï¼ˆã‚¯ã‚¨ãƒªãªã—ï¼‰
  - ãƒãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰: URL ã« ?hardï¼ˆä¾‹: ?hard, ?hard=1, ?hard=true, ?hard=onï¼‰
    ãƒ»èª¤ç­”ã—ã¦ 0ç•ªã«æˆ»ã£ãŸç›´å¾Œã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ä½•ã‚‚è¡¨ç¤ºã—ã¾ã›ã‚“
  - ã‚½ãƒ•ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼š URL ã« ?softï¼ˆä¾‹: ?soft, ?soft=1, ?soft=true, ?soft=onï¼‰
    ãƒ»æ­£è§£ã—ã¦å…ˆã¸é€²ã‚“ã å ´åˆã§ã‚‚ã€å‰å›ã®ç•°å¤‰ã‚’ #message ã«è¡¨ç¤ºã—ã¾ã™
  - é€šå¸¸ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ä»•æ§˜:
    ãƒ»èª¤ç­”ã—ã¦ 0ç•ªã«æˆ»ã£ãŸç›´å¾Œã«ã€åŸå› ï¼ˆè¦‹é€ƒã—/èª¤å ±ï¼‰ã‚’ #message ã«è¡¨ç¤ºã—ã¾ã™
  - ãƒ‡ãƒãƒƒã‚°è¡¨ç¤º: URL ã« ?debugï¼ˆä¾‹: ?debug, ?debug=1ï¼‰ã§ãƒ‡ãƒãƒƒã‚° UI ã‚’è¡¨ç¤º
  - ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: URL ã« ?sim=Nï¼ˆä¾‹: ?sim=1000, ?sim=5000ï¼‰ã§ä¹±æ•°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
    ãƒ»å®Ÿéš›ã®ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’Nå›å®Ÿè¡Œã—ã€æœ«å°¾10å€‹ã®å‡ºç¾é »åº¦ã‚’åˆ†æ
    ãƒ»çµæœã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã«è©³ç´°è¡¨ç¤º
    ãƒ»å›æ•°ã‚’æŒ‡å®šã—ãªã„å ´åˆï¼ˆ?simï¼‰ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1000å›
  - ã‚²ãƒ¼ãƒ ã®èµ·å‹•ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãï¼ˆä¾‹: file:///index.htmlã€ã‚‚ã—ãã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’dï¼†dã™ã‚‹ï¼‰
-->
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ï¼˜ç•ªé€šè·¯</title>
    <style>
        /* --- Google Fonts --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Orbitron:wght@400;700&display=swap');

        /* --- åŸºæœ¬è¨­å®š --- */
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --container-bg: rgba(30, 30, 30, 0.9);
            --border-color: #444;
            --title-color: #e53935;
            --message-color: #ffd700;
            --normal-light-color: #f0f0c0;
            --normal-sign-bg: #004d40;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Meiryo', 'Hiragino Kaku Gothic ProN', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            transition: background-color 1s ease, filter 1s ease;
        }

        .game-wrapper {
            position: relative;
            max-width: 800px;
            width: 90%;
            padding: 40px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--container-bg);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
            text-align: center;
            z-index: 2;
            overflow: hidden;
            transition: border-color 0.5s ease, border-radius 0.5s, background-color 0.5s, transform 0.5s, box-shadow 0.5s;
        }

        /* --- è¦–è¦šçš„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ --- */
        .ceiling-light {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) perspective(100px) rotateX(45deg);
            width: 50%;
            height: 40px;
            background: linear-gradient(#222, #333);
            border: 2px solid #111;
            transition: width 0.5s, border-radius 0.5s;
        }

        .ceiling-light::after {
            content: '';
            display: block;
            width: 90%;
            height: 80%;
            margin: 5% auto;
            background-color: var(--normal-light-color);
            box-shadow: 0 0 15px 5px var(--normal-light-color);
            transition: background-color 0.5s, box-shadow 0.5s, animation-duration 0.5s;
            animation: light-hum 7s infinite alternate ease-in-out;
        }

        @keyframes light-hum {
            from {
                opacity: 0.95;
            }

            to {
                opacity: 1;
            }
        }

        .wall-sign {
            position: absolute;
            top: 40%;
            right: -20px;
            transform: translateY(-50%) perspective(200px) rotateY(-30deg);
            width: 100px;
            height: 150px;
            background-color: var(--normal-sign-bg);
            border: 5px solid #ccc;
            border-radius: 5px;
            box-shadow: -5px 5px 15px rgba(0, 0, 0, 0.5);
            transition: transform 0.5s, background-color 0.5s, box-shadow 0.5s, opacity 0.5s, border-style 0.5s;
        }

        .wall-sign::before {
            content: 'éå¸¸å£';
            color: white;
            font-size: 24px;
            font-weight: bold;
            writing-mode: vertical-rl;
            text-orientation: upright;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: content 0.3s, font-family 0.3s, color 0.3s;
        }

        .poster {
            position: absolute;
            top: 50%;
            left: -10px;
            transform: translateY(-50%) perspective(200px) rotateY(25deg);
            width: 90px;
            height: 130px;
            background-color: #f0ead6;
            border: 3px solid #333;
            box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
            transition: transform 0.5s, background-color 0.5s, opacity 0.5s;
        }

        .poster::before {
            content: 'å®‰å…¨ç¬¬ä¸€';
            color: #333;
            font-size: 20px;
            font-weight: bold;
            writing-mode: vertical-rl;
            text-orientation: upright;
            white-space: nowrap;
            line-height: 1;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: content 0.3s;
        }

        .floor {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 25%;
            z-index: -1;
            background:
                linear-gradient(rgba(30, 30, 30, 0.9), rgba(30, 30, 30, 0.2)),
                repeating-linear-gradient(45deg, #444, #444 10px, #555 10px, #555 20px);
            transition: background 0.5s;
        }

        /* --- UIè¦ç´  --- */
        h1 {
            color: var(--title-color);
            font-family: 'Orbitron', sans-serif;
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(229, 57, 53, 0.7);
            transition: font-weight 0.5s, color 0.5s, text-shadow 0.5s;
        }

        #description {
            font-size: 1.2em;
            line-height: 1.8;
            min-height: 150px;
            white-space: pre-wrap;
            margin-bottom: 30px;
            transition: color 0.5s, font-family 0.8s, letter-spacing 0.5s, text-align 0.5s, transform 0.5s;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            transition: flex-direction 0.5s;
        }

        button {
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            transition: background-color 0.3s, transform 0.1s, opacity 0.3s, color 0.3s, box-shadow 0.3s, border-radius 0.3s;
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        button:hover:not(:disabled) {
            background-color: #45a049;
        }

        button:active:not(:disabled) {
            transform: scale(0.98);
        }

        #back-button {
            background-color: #f44336;
        }

        #back-button:hover:not(:disabled) {
            background-color: #da190b;
        }

        #message {
            margin-top: 20px;
            font-size: 1.2em;
            color: var(--message-color);
            font-weight: bold;
            height: 30px;
            transition: opacity 0.5s, color 0.5s, border 0.5s;
            box-sizing: border-box;
        }

        /* --- æš—è»¢ç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ --- */
        #fade-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            opacity: 0;
            z-index: 9999;
            pointer-events: none;
            transition: opacity 1s ease-in-out;
        }

        #fade-overlay.is-active {
            opacity: 1;
            pointer-events: auto;
        }

        /* --- ç•°å¤‰é©ç”¨æ™‚ã¯ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã‚’æŠ‘æ­¢ï¼ˆè¦‹ç ´ã‚Šé˜²æ­¢ï¼‰ --- */
        #game-wrapper.no-transition,
        #game-wrapper.no-transition * {
            transition: none !important;
        }

        body.no-transition-filter {
            transition: none !important;
        }

        /* --- è¿½åŠ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ --- */
        .puddle {
            position: absolute;
            bottom: 5%;
            left: 50%;
            width: 100px;
            height: 30px;
            background: rgba(80, 120, 150, 0.3);
            border-radius: 50%;
            transform: translateX(-50%) perspective(50px) rotateX(60deg);
            box-shadow: 0 0 10px rgba(80, 120, 150, 0.5);
            display: none;
        }

        .anomaly-puddle .puddle {
            display: block;
        }

        .crack {
            position: absolute;
            top: 20%;
            left: 10%;
            width: 5px;
            height: 150px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            transform: rotate(20deg);
            display: none;
        }

        .crack::after {
            content: '';
            position: absolute;
            top: 50px;
            left: -30px;
            width: 3px;
            height: 80px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50%;
            transform: rotate(-40deg);
        }

        .anomaly-crack .crack {
            display: block;
        }

        /* --- ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #debug-toggle-btn {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 8px 12px;
            border: 1px solid #0f0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10001;
            cursor: pointer;
            display: none;
        }

        #debug-toggle-btn:hover {
            background: rgba(0, 150, 0, 0.3);
        }

        #debug-info {
            position: fixed;
            bottom: 45px;
            left: 10px;
            background: rgba(0, 0, 0, 0.95);
            color: #0f0;
            padding: 15px;
            border: 1px solid #0f0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.5;
            z-index: 10000;
            text-align: left;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
        }

        #debug-info.hidden {
            display: none !important;
        }

        #debug-info h3 {
            margin: 0 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #0f0;
            color: #0f0;
            font-size: 14px;
        }

        #debug-info select,
        #debug-info button {
            margin-top: 10px;
            width: 100%;
            font-size: 11px;
        }

        #debug-info select {
            max-height: 200px;
        }

        /* --- ç•°å¤‰ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        .anomaly-light-red .ceiling-light::after {
            background-color: #ff4d4d;
            box-shadow: 0 0 20px 10px #ff4d4d;
        }

        .anomaly-light-flicker .ceiling-light::after {
            animation: flicker 0.3s infinite alternate;
        }

        @keyframes flicker {
            0% {
                opacity: 1;
            }

            40% {
                opacity: 0.3;
            }

            100% {
                opacity: 0.8;
            }
        }

        .anomaly-light-off .ceiling-light::after {
            background-color: #333;
            box-shadow: none;
        }

        .anomaly-light-green .ceiling-light::after {
            background-color: #4caf50;
            box-shadow: 0 0 20px 10px #4caf50;
        }

        .anomaly-light-narrow .ceiling-light {
            width: 40%;
        }

        .anomaly-sign-crooked .wall-sign {
            transform: translateY(-50%) perspective(200px) rotateY(-30deg) rotateZ(-15deg);
        }

        .anomaly-sign-garbled .wall-sign::before {
            font-family: 'MS Mincho';
        }

        .anomaly-sign-shadow .wall-sign {
            box-shadow: -5px 5px 15px rgba(200, 0, 0, 0.5);
        }

        .anomaly-sign-blue .wall-sign {
            background-color: #1565c0;
        }

        .anomaly-sign-missing .wall-sign {
            opacity: 0;
        }

        .anomaly-sign-text-changed .wall-sign::before {
            content: 'å…¥å£';
        }

        .anomaly-sign-dashed .wall-sign {
            border-style: dashed;
        }

        .anomaly-sign-text-yellow .wall-sign::before {
            color: yellow;
        }

        .anomaly-font-creepy #description {
            font-family: 'Noto Serif JP', serif;
            color: #bbb;
        }

        .anomaly-shake {
            animation: shake 5s infinite linear;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-4px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(4px);
            }
        }

        .anomaly-letter-spacing #description {
            letter-spacing: 0.1em;
        }

        .anomaly-title-weight h1 {
            font-weight: 400;
        }

        .anomaly-text-align-justify #description {
            text-align: justify;
        }

        .anomaly-border-radius {
            border-radius: 50px;
        }

        .anomaly-buttons-swapped .buttons {
            flex-direction: row-reverse;
        }

        .anomaly-text-color-strong {
            color: #f06292 !important;
        }

        .anomaly-title-color-strong {
            color: #ff5722 !important;
        }

        .anomaly-border-color-strong {
            border-color: #6a1b9a !important;
        }

        .anomaly-bg-strong {
            background-color: #0d47a1 !important;
        }

        .anomaly-wrapper-bg-strong {
            background-color: rgba(70, 20, 20, 0.9) !important;
        }

        .anomaly-puddle-green .puddle {
            display: block;
            background: rgba(50, 150, 50, 0.5);
            box-shadow: 0 0 15px rgba(50, 150, 50, 0.7);
        }

        .anomaly-crack-red .crack,
        .anomaly-crack-red .crack::after {
            display: block;
            background: rgba(255, 0, 0, 0.5);
        }

        .anomaly-floor-yellow .floor {
            background: linear-gradient(rgba(30, 30, 30, 0.9), rgba(30, 30, 30, 0.2)), repeating-linear-gradient(45deg, #FFD700, #FFD700 10px, #FFC107 10px, #FFC107 20px);
        }

        .anomaly-border-color-green {
            border-color: #4caf50 !important;
        }

        .anomaly-border-color-blue {
            border-color: #2196f3 !important;
        }

        .anomaly-floor-red .floor {
            background: linear-gradient(rgba(30, 30, 30, 0.2), rgba(30, 30, 30, 0.1)), repeating-linear-gradient(45deg, #b71c1c, #b71c1c 10px, #c62828 10px, #c62828 20px);
        }

        .anomaly-floor-blue .floor {
            background: linear-gradient(rgba(30, 30, 30, 0.2), rgba(30, 30, 30, 0.1)), repeating-linear-gradient(90deg, #1a237e, #1a237e 10px, #283593 10px, #283593 20px);
        }

        .anomaly-poster-upside-down .poster {
            transform: translateY(-50%) perspective(200px) rotateY(25deg) rotateZ(180deg);
        }

        .anomaly-poster-text-garbled .poster::before {
            content: 'â– â– â– â– ';
        }

        /* Mirror text on the right exit sign */
        .anomaly-sign-text-mirrored .wall-sign::before {
            transform: translate(-50%, -50%) scaleX(-1);
        }

        /* Mirror text on the left poster */
        .anomaly-poster-text-mirrored .poster::before {
            transform: translate(-50%, -50%) scaleX(-1);
        }

        .anomaly-sign-open .wall-sign {
            transform: translateY(-50%) perspective(200px) rotateY(-70deg);
        }

        .anomaly-sign-open .wall-sign::before {
            content: '';
        }

        .anomaly-sign-open .wall-sign::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
        }

        .anomaly-sign-peeking .wall-sign::after {
            content: 'ğŸ‘€';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
        }

        .anomaly-buttons-black-text button {
            color: #000;
        }

        .anomaly-poster-missing .poster {
            opacity: 0;
        }

        .anomaly-poster-text-changed .poster::before {
            content: 'å±é™º';
        }

        .anomaly-poster-color-changed .poster {
            background-color: #add8e6;
        }

        /* Poster size variations */
        .anomaly-poster-bigger .poster {
            transform: translateY(-50%) perspective(200px) rotateY(25deg) scale(1.3);
        }

        .anomaly-poster-smaller .poster {
            transform: translateY(-50%) perspective(200px) rotateY(25deg) scale(0.7);
        }

        /* Eye on the poster (peeking style, same as sign) */
        .anomaly-poster-eye .poster::after {
            content: 'ğŸ‘€';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 40px;
            filter: drop-shadow(0 0 6px rgba(0, 0, 0, 0.7));
        }

        .anomaly-text-upside-down #description {
            transform: rotate(180deg);
        }

        .anomaly-text-mirrored #description {
            transform: scaleX(-1);
        }

        .anomaly-floor-angle-changed .floor {
            background: linear-gradient(rgba(30, 30, 30, 0.9), rgba(30, 30, 30, 0.2)), repeating-linear-gradient(135deg, #444, #444 10px, #555 10px, #555 20px);
        }

        .anomaly-floor-steeper-angle .floor {
            background: linear-gradient(rgba(30, 30, 30, 0.9), rgba(30, 30, 30, 0.2)),
                repeating-linear-gradient(60deg, #444, #444 10px, #555 10px, #555 20px);
        }

        .anomaly-floor-wider-stripes .floor {
            background: linear-gradient(rgba(30, 30, 30, 0.9), rgba(30, 30, 30, 0.2)),
                repeating-linear-gradient(45deg, #444, #444 10px, #555 10px, #555 25px);
        }

        .anomaly-puddle-red .puddle {
            display: block;
            background: rgba(150, 50, 50, 0.5);
            box-shadow: 0 0 15px rgba(150, 50, 50, 0.7);
        }

        .anomaly-title-shadow-green h1 {
            text-shadow: 0 0 15px #0f0;
        }

        .anomaly-buttons-glow button {
            box-shadow: 0 0 15px #fff;
        }


        .anomaly-wrapper-rotated {
            transform: rotate(-2deg);
        }

        .anomaly-message-border #message {
            border: 1px solid var(--message-color);
        }

        /* removed: fast flicker anomaly per request */

        .anomaly-buttons-square button {
            border-radius: 0;
        }

        .anomaly-buttons-logic-swapped #forward-button,
        .anomaly-buttons-logic-swapped #back-button {
            position: relative;
            color: transparent;
            /* Hide original text */
        }

        .anomaly-buttons-logic-swapped #forward-button::after {
            content: 'æˆ»ã‚‹';
            /* "Back" text on the forward button */
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            color: #fff;
        }

        .anomaly-buttons-logic-swapped #back-button::after {
            content: 'é€²ã‚€';
            /* "Forward" text on the back button */
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            color: #fff;
        }

        .anomaly-buttons-logic-swapped #forward-button,
        .anomaly-buttons-logic-swapped #back-button {
            position: relative;
            color: transparent;
            /* Hide original text */
        }

        .anomaly-buttons-logic-swapped #forward-button::after {
            content: 'æˆ»ã‚‹';
            /* "Back" text on the forward button */
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            color: #fff;
        }

        .anomaly-buttons-logic-swapped #back-button::after {
            content: 'é€²ã‚€';
            /* "Forward" text on the back button */
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            color: #fff;
        }

        /* --- Added anomalies (request) --- */
        /* 2. Forward button label becomes imperative "é€²ã‚" */
        .anomaly-forward-imperative #forward-button {
            position: relative;
            color: transparent;
        }

        .anomaly-forward-imperative #forward-button::after {
            content: 'é€²ã‚';
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            color: #fff;
        }

        /* 3. Back button label becomes imperative "æˆ»ã‚Œ" */
        .anomaly-back-imperative #back-button {
            position: relative;
            color: transparent;
        }

        .anomaly-back-imperative #back-button::after {
            content: 'æˆ»ã‚Œ';
            position: absolute;
            inset: 0;
            display: grid;
            place-items: center;
            color: #fff;
        }

        /* 4. Panties at bottom-right */
        #game-wrapper.anomaly-panties-br::after {
            content: 'ğŸ©²';
            position: absolute;
            right: 8px;
            bottom: 6px;
            font-size: 28px;
            transform: rotate(15deg);
            filter: drop-shadow(2px 4px 3px rgba(0, 0, 0, 0.5)) brightness(0.7);
            pointer-events: none;
        }

        /* 5. Trunks at bottom-left */
        #game-wrapper.anomaly-trunks-bl::before {
            content: 'ğŸ©³';
            position: absolute;
            left: 8px;
            bottom: 6px;
            font-size: 28px;
            transform: rotate(-15deg);
            filter: drop-shadow(2px 4px 3px rgba(0, 0, 0, 0.5)) brightness(0.7);
            pointer-events: none;
        }

        /* Anomaly: Hand from floor */
        #game-wrapper.anomaly-floor-hand::after {
            content: 'âœ‹';
            position: absolute;
            bottom: 5%;
            right: 15%;
            font-size: 50px;
            transform: rotate(-30deg);
            z-index: 0;
        }

        /* Anomaly: Shadow hand from floor */
        #game-wrapper.anomaly-floor-shadow-hand::after {
            content: 'âœ‹';
            position: absolute;
            bottom: 5%;
            right: 15%;
            font-size: 60px;
            color: #000;
            opacity: 0.6;
            transform: rotate(-30deg);
            filter: blur(3px);
            z-index: 0;
        }

        /* Anomaly: Bamboo shoot from floor */
        #game-wrapper.anomaly-floor-bamboo::before {
            content: 'â–²';
            position: absolute;
            bottom: 5%;
            left: 15%;
            font-size: 50px;
            color: #D2B48C;
            /* Light brown */
            transform: scaleY(1.5);
            filter: blur(1px);
            z-index: 0;
        }

        /* Anomaly: Mushroom from floor */
        #game-wrapper.anomaly-floor-mushroom::before {
            content: 'ğŸ„â€ğŸŸ«';
            position: absolute;
            bottom: 5%;
            left: 15%;
            font-size: 50px;
            z-index: 0;
        }

        /* Anomaly: Grass from floor */
        #game-wrapper.anomaly-floor-grass::before {
            content: 'ğŸŒ¿';
            position: absolute;
            bottom: 5%;
            left: 15%;
            font-size: 50px;
            z-index: 0;
        }

        /* Anomaly: W from floor */
        #game-wrapper.anomaly-floor-w::before {
            content: 'W';
            position: absolute;
            bottom: 5%;
            left: 15%;
            font-size: 50px;
            font-weight: bold;
            color: #fff;
            z-index: 0;
        }

        /* 6. Poster text "å®‰å…¨å¼Ÿä¸€" */
        .anomaly-poster-safety-brother .poster::before {
            content: 'å®‰å…¨å¼Ÿä¸€';
        }

        /* Poster text "å®‰å…¨å®‰å¿ƒ" */
        .anomaly-poster-safety-anshin .poster::before {
            content: 'å®‰å…¨å®‰å¿ƒ';
        }

        /* 7. (Removed) Message ellipsis color black â€” deleted per request */

        /* 8. Exit sign position higher/lower */
        .anomaly-sign-higher .wall-sign {
            top: 30%;
        }

        .anomaly-sign-lower .wall-sign {
            top: 50%;
        }

        /* 9. Poster position higher/lower */
        .anomaly-poster-higher .poster {
            top: 40%;
        }

        .anomaly-poster-lower .poster {
            top: 60%;
        }

        /* 10. Passage title slightly lower */
        .anomaly-passage-title-lower #passage-title {
            transform: translateY(8px);
        }

        /* 11. Ceiling light stronger blur */
        .anomaly-light-blur-stronger .ceiling-light::after {
            box-shadow: 0 0 22px 8px var(--normal-light-color);
        }

        /* 12. Buttons avoid cursor (JS-driven; optional easing here) */
        .anomaly-buttons-avoid-cursor .buttons button {
            will-change: transform;
        }

        /* New: cursor appears faint (light, semi-transparent) */
        .anomaly-cursor-faint#game-wrapper,
        .anomaly-cursor-faint#game-wrapper * {
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16'><circle cx='8' cy='8' r='6' fill='%23fff' fill-opacity='0.35' stroke='%23fff' stroke-opacity='0.35'/></svg>") 8 8, default;
        }

        /* New: dim the game when cursor leaves wrapper (active only when anomaly on) */
        .anomaly-dim-on-leave#game-wrapper.is-dimmed {
            filter: brightness(0.6) contrast(0.95);
        }

        /* New: cursor trail dots */
        .anomaly-cursor-trail .cursor-trail-dot {
            position: absolute;
            left: 0;
            top: 0;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.35);
            transform: translate(-50%, -50%) scale(1);
            pointer-events: none;
            filter: blur(0.4px);
            animation: trailFade 0.6s ease-out forwards;
            z-index: 5;
        }

        @keyframes trailFade {
            from {
                opacity: 0.35;
                transform: translate(-50%, -50%) scale(1);
            }

            to {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.8);
            }
        }

        body.anomaly-body-grayscale {
            filter: grayscale(100%);
        }

        body.anomaly-body-sepia {
            filter: sepia(100%);
        }

        body.anomaly-body-invert {
            filter: invert(100%);
        }

        body.anomaly-body-hue-rotate {
            filter: hue-rotate(180deg);
        }

        body.anomaly-body-blur {
            filter: blur(3px);
        }

        body.anomaly-body-contrast {
            filter: contrast(200%);
        }

        /* Background silhouette (bring above wrapper for visibility) */
        body.anomaly-body-silhouette::before {
            content: 'ğŸ‘¤';
            position: fixed;
            left: 50%;
            top: 35%;
            transform: translate(-50%, -50%);
            font-size: 220px;
            color: rgba(255, 255, 255, 0.18);
            text-shadow: 0 0 12px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            z-index: 3;
            /* above wrapper (z-index:2), below fade/debug */
        }

        /* Body anomaly: small heart at browser top-left */
        body.anomaly-body-heart-topleft::before {
            content: 'â¤';
            position: fixed;
            top: 8px;
            left: 10px;
            font-size: 22px;
            color: #ff5a77;
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.35);
            pointer-events: none;
            z-index: 10000;
            /* ensure above UI */
            animation: heartPulse 1.6s ease-in-out infinite;
        }

        /* Body anomaly: diamond at browser top-right */
        body.anomaly-body-diamond-topright::before {
            content: 'â™¦';
            position: fixed;
            top: 8px;
            right: 10px;
            font-size: 26px;
            color: #ff5a77;
            text-shadow: 0 0 6px rgba(0, 0, 0, 0.35);
            pointer-events: none;
            z-index: 10000;
        }

        /* Body anomaly: spade at browser bottom-right */
        body.anomaly-body-spade-bottomright::before {
            content: 'â™ ';
            position: fixed;
            bottom: 8px;
            right: 10px;
            font-size: 26px;
            color: #444;
            text-shadow: 0 0 6px rgba(255, 255, 255, 0.2);
            pointer-events: none;
            z-index: 10000;
        }

        /* Body anomaly: club at browser bottom-left */
        body.anomaly-body-club-bottomleft::before {
            content: 'â™£';
            position: fixed;
            bottom: 8px;
            left: 10px;
            font-size: 26px;
            color: #444;
            text-shadow: 0 0 6px rgba(255, 255, 255, 0.2);
            pointer-events: none;
            z-index: 10000;
        }

        @keyframes heartPulse {
            from {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            to {
                transform: scale(1);
            }
        }
    </style>
</head>

<body>

    <div id="fade-overlay"></div>
    <button id="debug-toggle-btn">ãƒ‡ãƒãƒƒã‚°è¡¨ç¤º</button>
    <div id="debug-info"></div>

    <div class="game-wrapper" id="game-wrapper">
        <div class="ceiling-light"></div>
        <div class="wall-sign"></div>
        <div class="poster"></div>
        <div class="floor"></div>
        <div class="puddle"></div>
        <div class="crack"></div>
        <h1 id="passage-title">0ç•ªé€šè·¯</h1>
        <p id="description"></p>
        <div class="buttons">
            <button id="forward-button">é€²ã‚€</button>
            <button id="back-button">æˆ»ã‚‹</button>
        </div>
        <p id="message"></p>
    </div>

    <script>
        const wrapper = document.getElementById('game-wrapper');
        const passageTitle = document.getElementById('passage-title');
        const description = document.getElementById('description');
        const forwardButton = document.getElementById('forward-button');
        const backButton = document.getElementById('back-button');
        const message = document.getElementById('message');
        const fadeOverlay = document.getElementById('fade-overlay');
        const bodyEl = document.body;
        const debugInfo = document.getElementById('debug-info');
        const debugToggleBtn = document.getElementById('debug-toggle-btn');
        // --- For anomaly #12: buttons avoid cursor ---
        let avoidCursorActive = false;
        let buttonLogicSwapped = false;
        const buttons = () => Array.from(wrapper.querySelectorAll('.buttons button'));
        function resetButtonTransforms() {
            buttons().forEach(btn => { btn.style.transform = ''; });
        }
        function handleMouseMoveAvoid(e) {
            if (!avoidCursorActive) return;
            const mx = e.clientX;
            const my = e.clientY;
            const maxRadius = 120; // proximity radius
            const maxPush = 18;    // max px to push away
            buttons().forEach(btn => {
                const rect = btn.getBoundingClientRect();
                const cx = rect.left + rect.width / 2;
                const cy = rect.top + rect.height / 2;
                const dx = cx - mx;
                const dy = cy - my;
                const dist = Math.hypot(dx, dy) || 1;
                if (dist < maxRadius) {
                    const scale = (1 - dist / maxRadius);
                    const mag = maxPush * scale;
                    const nx = dx / dist;
                    const ny = dy / dist;
                    const tx = nx * mag;
                    const ty = ny * mag;
                    btn.style.transform = `translate(${tx.toFixed(1)}px, ${ty.toFixed(1)}px)`;
                } else {
                    btn.style.transform = '';
                }
            });
        }
        wrapper.addEventListener('mousemove', handleMouseMoveAvoid);
        wrapper.addEventListener('mouseleave', resetButtonTransforms);
        // --- For anomaly: dim screen when cursor leaves ---
        let dimOnLeaveActive = false;
        wrapper.addEventListener('mouseenter', () => {
            if (dimOnLeaveActive) wrapper.classList.remove('is-dimmed');
        });
        wrapper.addEventListener('mouseleave', () => {
            if (dimOnLeaveActive) wrapper.classList.add('is-dimmed');
        });
        // --- For anomaly: cursor trail ---
        let cursorTrailActive = false;
        function spawnCursorTrailDot(x, y) {
            const dot = document.createElement('div');
            dot.className = 'cursor-trail-dot';
            dot.style.left = `${x}px`;
            dot.style.top = `${y}px`;
            wrapper.appendChild(dot);
            // Remove after animation
            setTimeout(() => dot.remove(), 650);
        }
        function handleMouseMoveTrail(e) {
            if (!cursorTrailActive) return;
            const rect = wrapper.getBoundingClientRect();
            spawnCursorTrailDot(e.clientX - rect.left, e.clientY - rect.top);
        }
        wrapper.addEventListener('mousemove', handleMouseMoveTrail);
        // --- For anomaly: URL bar shows "ãŒã‚“ã°ã‚Œãƒ¼" ---
        let urlGanbareActive = false;
        const originalURLHash = location.hash;

        let currentPassage = 0;
        let hasAnomaly = false;
        let currentAnomaly = {};
        let isFirstTurn = true;
        let isDebugMode = false;
        let shuffledAnomalies = [];
        let originalAnomalies = [];
        // Hard mode toggle from URL and pending message store
        let isHardMode = false;
        let isSoftMode = false;
        let pendingReturnMessage = '';
        let pendingProceedMessage = '';
        // Debug: anomaly selection counters
        const anomalyCountByClass = new Map();
        let anomalyPickTotal = 0;
        function incAnomalyCount(cls) {
            const key = cls || '(text-only)';
            anomalyCountByClass.set(key, (anomalyCountByClass.get(key) || 0) + 1);
            anomalyPickTotal++;
        }
        function resetAnomalyCounts() {
            anomalyCountByClass.clear();
            anomalyPickTotal = 0;
        }

        // Enable debug if the param is truthy or present
        function isDebugEnabledFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (!params.has('debug')) return false;
            const raw = params.get('debug');
            if (raw === null) return true;
            const v = String(raw).toLowerCase();
            return v === '' || v === 'true' || v === '1' || v === 'on' || v === 'yes' || v === 'y' || v === 't' || v === 'ture';
        }

        // Enable hard mode if the param is truthy or present
        function isHardModeEnabledFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (!params.has('hard')) return false;
            const raw = params.get('hard');
            if (raw === null) return true;
            const v = String(raw).toLowerCase();
            return v === '' || v === 'true' || v === '1' || v === 'on' || v === 'yes' || v === 'y' || v === 't' || v === 'ture';
        }

        // Enable soft mode if the param is truthy or present
        function isSoftModeEnabledFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (!params.has('soft')) return false;
            const raw = params.get('soft');
            if (raw === null) return true;
            const v = String(raw).toLowerCase();
            return v === '' || v === 'true' || v === '1' || v === 'on' || v === 'yes' || v === 'y' || v === 't' || v === 'ture';
        }

        // Enable simulation mode if the param is truthy or present
        function isSimModeEnabledFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (!params.has('sim')) return false;
            // simãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚Œã°å¸¸ã«trueï¼ˆæ•°å€¤æŒ‡å®šã‚‚å«ã‚€ï¼‰
            return true;
        }

        // Get simulation iteration count from URL
        function getSimIterationsFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (!params.has('sim')) return 1000;
            const raw = params.get('sim');
            // æ•°å€¤ã¨ã—ã¦è§£é‡ˆã§ãã‚‹å ´åˆã¯ãã®å€¤ã‚’ä½¿ç”¨
            const num = parseInt(raw, 10);
            if (!isNaN(num) && num > 0) return num;
            // ãã‚Œä»¥å¤–ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1000å›
            return 1000;
        }

        const normalDescription = "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚";

        const anomalies = [
            // ãƒ†ã‚­ã‚¹ãƒˆç•°å¤‰
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹,", class: '', hint: 'æ–‡æœ«ãŒã€Œã€ã€ã«ãªã£ã¦ã„ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œã‚¸ãƒ¼â€¦ã€ã®ã€Œâ€¦ã€ãŒãªã‹ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¥ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ä¸‰ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼ã€Œâ€¦ã€ãŒäºŒç‚¹ã€Œâ€¥ã€ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ï¼", class: '', hint: 'æ–‡æœ«ãŒã€Œï¼ã€ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹?", class: '', hint: 'æ–‡æœ«ãŒã€Œï¼Ÿã€ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚ã€‚", class: '', hint: 'å¥ç‚¹ãŒ2ã¤ã‚ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ï¼\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ï¼\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ï¼", class: '', hint: 'å¥ç‚¹ãŒå…¨è§’ãƒ”ãƒªã‚ªãƒ‰ã€Œï¼ã€ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\n\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'æ–‡ç« ã®é–“ãŒä¸€è¡Œç©ºã„ã¦ã„ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ãŸã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œç«‹ã¦ã¦ã€ãŒã²ã‚‰ãŒãªã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è¢å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œè›å…‰ç¯ã€ã®æ¼¢å­—ãŒé•ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nç’§ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œå£ã€ã®æ¼¢å­—ãŒé•ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã¤ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œå…‰ã£ã¦ã„ã‚‹ã€ã®ã€Œã£ã€ãŒãªã‹ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£æ”¾ã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œã±ãªã—ã€ã®è¡¨è¨˜ãŒé•ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨è¨€ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œã¨ã„ã†ã€ãŒæ¼¢å­—ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚·ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'æ“¬éŸ³ãŒã€Œã‚·ãƒ¼â€¦ã€ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“æ”¾ã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œæ‰“ã¡ã£ã±ãªã—ã€ã®è¡¨è¨˜ãŒé•ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«å±…ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œã„ã‚‹ã€ãŒæ¼¢å­—ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãè¼ã„ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œå…‰ã£ã¦ã„ã‚‹ã€ãŒã€Œè¼ã„ã¦ã„ã‚‹ã€ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯è³ªç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œç°¡ç´ ãªã€ãŒã€Œè³ªç´ ãªã€ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã†ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œæ‰“ã¡ã£ã±ãªã—ã€ãŒã²ã‚‰ãŒãªã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†ãŠã¨ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€ŒéŸ³ã€ãŒã²ã‚‰ãŒãªã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãã²ã‹ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œå…‰ã£ã¦ã„ã‚‹ã€ãŒã²ã‚‰ãŒãªã ã£ãŸ' },
            { desc: "ã‚ãªãŸãƒç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ãƒã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ãƒè›å…‰ç¯ã‚¬ã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ãƒ²ç«‹ã¦ã¦ç™½ã‚¯å…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'åŠ©è©ãŒã‚«ã‚¿ã‚«ãƒŠã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã®é€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯æ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'æ–‡ç« ã®æ§‹æˆãŒå°‘ã—é•ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦èµ¤ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ãƒ†ã‚­ã‚¹ãƒˆã§ã€Œèµ¤ãã€ã¨æ›¸ã‹ã‚Œã¦ã„ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚", class: '', hint: 'æœ€å¾Œã®æ–‡ç« ãŒãªã‹ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'çœŸã‚“ä¸­ã®æ–‡ç« ãŒãªã‹ã£ãŸ' },
            { desc: "å£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'æœ€åˆã®æ–‡ç« ãŒãªã‹ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nåºŠã¯æ¿¡ã‚Œã¦ã„ã‚‹ã€‚", class: '', hint: 'æ–‡ç« ã®å†…å®¹ãŒä¸€éƒ¨é•ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ãªã„ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œã„ã‚‹ã€ãŒã€Œã„ãªã„ã€ã«ãªã£ã¦ã„ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã§ã¯ãªã„ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'æ–‡ç« ãŒä¸€éƒ¨å¦å®šå½¢ã ã£ãŸ' },
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©äº•ã®è›å…‰ç¯ãŒã€éŸ³ã‚‚ãªãç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€ŒéŸ³ã‚‚ãªãã€ã¨æ›¸ã‹ã‚Œã¦ã„ãŸ' },
            { desc: normalDescription + "\nèƒŒå¾Œã«æ°—é…ãŒã™ã‚‹ã€‚", class: '', hint: 'æ–‡æœ«ã«ä¸€æ–‡è¿½åŠ ã•ã‚Œã¦ã„ãŸ' },

            // CSSç•°å¤‰
            { desc: normalDescription, class: 'anomaly-title-weight', hint: 'é€šè·¯ç•ªå·ã®å¤ªã•ãŒé•ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-light-red', hint: 'å¤©äº•ã®ç…§æ˜ãŒèµ¤ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-light-flicker', hint: 'å¤©äº•ã®ç…§æ˜ãŒç‚¹æ»…ã—ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-light-off', hint: 'å¤©äº•ã®ç…§æ˜ãŒæ¶ˆãˆã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-light-green', hint: 'å¤©äº•ã®ç…§æ˜ãŒç·‘è‰²ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-light-narrow', hint: 'å¤©äº•ã®ç…§æ˜ãŒç´°ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-font-creepy', hint: 'èª¬æ˜æ–‡ã®ãƒ•ã‚©ãƒ³ãƒˆãŒé•ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-shake', hint: 'ç”»é¢ãŒæºã‚Œã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-text-color-strong', hint: 'èª¬æ˜æ–‡ã®è‰²ãŒãƒ”ãƒ³ã‚¯ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-letter-spacing', hint: 'èª¬æ˜æ–‡ã®æ–‡å­—é–“éš”ãŒåºƒã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-title-color-strong', hint: 'é€šè·¯ç•ªå·ã®è‰²ãŒã‚ªãƒ¬ãƒ³ã‚¸ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-crooked', hint: 'éå¸¸å£ãŒå‚¾ã„ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-garbled', hint: 'éå¸¸å£ã®ãƒ•ã‚©ãƒ³ãƒˆãŒé•ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-shadow', hint: 'éå¸¸å£ã®å½±ãŒèµ¤ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-blue', hint: 'éå¸¸å£ã®è‰²ãŒé’ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-missing', hint: 'å·¦ã®ãƒã‚¹ã‚¿ãƒ¼ãŒãªã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-text-changed', hint: 'éå¸¸å£ã®æ–‡å­—ãŒã€Œå…¥å£ã€ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-text-mirrored', hint: 'éå¸¸å£ã®æ–‡å­—ãŒé¡æ–‡å­—ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-dashed', hint: 'éå¸¸å£ã®æ ç·šãŒç‚¹ç·šã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-text-yellow', hint: 'éå¸¸å£ã®æ–‡å­—ãŒé»„è‰²ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-open', hint: 'éå¸¸å£ã®ãƒ‰ã‚¢ãŒé–‹ã„ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-sign-peeking', hint: 'éå¸¸å£ã®ä¸Šã‹ã‚‰èª°ã‹ãŒè¦‹ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-text-align-justify', hint: 'èª¬æ˜æ–‡ãŒä¸¡ç«¯æƒãˆã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-border-radius', hint: 'å…¨ä½“ã®æ ãŒä¸¸ã¾ã£ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-buttons-swapped', hint: 'é€²ã‚€/æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®ä½ç½®ãŒé€†ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-buttons-black-text', hint: 'ãƒœã‚¿ãƒ³ã®æ–‡å­—ãŒé»’ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-puddle', hint: 'åºŠã«æ°´ãŸã¾ã‚ŠãŒã‚ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-puddle-green', hint: 'åºŠã®æ°´ãŸã¾ã‚ŠãŒç·‘è‰²ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-crack', hint: 'å£ã«äº€è£‚ãŒã‚ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-crack-red', hint: 'å£ã®äº€è£‚ãŒèµ¤ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-border-color-strong', hint: 'å…¨ä½“ã®æ ç·šã®è‰²ãŒç´«ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-border-color-green', hint: 'å…¨ä½“ã®æ ç·šã®è‰²ãŒç·‘ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-border-color-blue', hint: 'å…¨ä½“ã®æ ç·šã®è‰²ãŒé’ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-bg-strong', hint: 'èƒŒæ™¯ã®è‰²ãŒæ¿ƒã„é’ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-wrapper-bg-strong', hint: 'ã‚²ãƒ¼ãƒ ç”»é¢ã®èƒŒæ™¯ãŒæ¿ƒã„èµ¤ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-yellow', hint: 'åºŠã®æ¨¡æ§˜ãŒé»„è‰²ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-red', hint: 'åºŠã®æ¨¡æ§˜ãŒèµ¤ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-blue', hint: 'åºŠã®æ¨¡æ§˜ãŒé’ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-upside-down', hint: 'å·¦ã®ãƒã‚¹ã‚¿ãƒ¼ãŒé€†ã•ã¾ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-text-garbled', hint: 'å·¦ã®ãƒã‚¹ã‚¿ãƒ¼ã®æ–‡å­—ãŒåŒ–ã‘ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-missing', hint: 'å·¦ã®ãƒã‚¹ã‚¿ãƒ¼ãŒãªã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-text-changed', hint: 'ãƒã‚¹ã‚¿ãƒ¼ã®æ–‡å­—ãŒã€Œå±é™ºã€ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-text-mirrored', hint: 'å·¦ã®ãƒã‚¹ã‚¿ãƒ¼ã®æ–‡å­—ãŒé¡æ–‡å­—ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-color-changed', hint: 'ãƒã‚¹ã‚¿ãƒ¼ã®è‰²ãŒæ°´è‰²ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-bigger', hint: 'å·¦ã®ãƒã‚¹ã‚¿ãƒ¼ãŒå¤§ãããªã£ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-smaller', hint: 'å·¦ã®ãƒã‚¹ã‚¿ãƒ¼ãŒå°ã•ããªã£ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-poster-eye', hint: 'å·¦ã®ãƒã‚¹ã‚¿ãƒ¼ã«ç›®ç‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-text-upside-down', hint: 'èª¬æ˜æ–‡ãŒé€†ã•ã¾ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-text-mirrored', hint: 'èª¬æ˜æ–‡ãŒé¡æ–‡å­—ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-angle-changed', hint: 'åºŠã®æ¨¡æ§˜ã®è§’åº¦ãŒé€†ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-steeper-angle', hint: 'åºŠã®æ–œç·šã®è§’åº¦ãŒæ€¥ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-wider-stripes', hint: 'åºŠã®æ¨¡æ§˜ã®ç·šã®å¹…ãŒå‡ä¸€ã§ã¯ãªã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-puddle-red', hint: 'åºŠã®æ°´ãŸã¾ã‚ŠãŒèµ¤ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-title-shadow-green', hint: 'é€šè·¯ç•ªå·ã®å½±ãŒç·‘ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-buttons-glow', hint: 'ãƒœã‚¿ãƒ³ãŒå…‰ã£ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-wrapper-rotated', hint: 'å…¨ä½“ãŒåƒ…ã‹ã«å‚¾ã„ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-message-border', hint: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¬„ã«æ ãŒã‚ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-buttons-square', hint: 'ãƒœã‚¿ãƒ³ãŒå››è§’ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-grayscale', hint: 'å…¨ä½“ãŒç™½é»’ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-sepia', hint: 'å…¨ä½“ãŒã‚»ãƒ”ã‚¢è‰²ã ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-invert', hint: 'å…¨ä½“ã®è‰²ãŒåè»¢ã—ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-hue-rotate', hint: 'å…¨ä½“ã®è‰²ç›¸ãŒå›è»¢ã—ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-blur', hint: 'å…¨ä½“ãŒã¼ã‚„ã‘ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-contrast', hint: 'å…¨ä½“ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãŒé«˜ã‹ã£ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-silhouette', hint: 'èƒŒæ™¯ã«äººå½±ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãŸ' },

            // --- Added anomalies (request) ---
            // 1. ã€Œå¤©äº•ã€ãŒã€Œå¤©ä¸¼ã€
            { desc: "ã‚ãªãŸã¯ç°¡ç´ ãªé€šè·¯ã«ã„ã‚‹ã€‚\nå£ã¯ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆæ‰“ã¡ã£ã±ãªã—ã ã€‚\nå¤©ä¸¼ã®è›å…‰ç¯ãŒã€ã‚¸ãƒ¼â€¦ã¨ã„ã†éŸ³ã‚’ç«‹ã¦ã¦ç™½ãå…‰ã£ã¦ã„ã‚‹ã€‚", class: '', hint: 'ã€Œå¤©äº•ã€ãŒã€Œå¤©ä¸¼ã€ã ã£ãŸ' },
            // 2. é€²ã‚€->é€²ã‚
            { desc: normalDescription, class: 'anomaly-forward-imperative', hint: 'ãƒœã‚¿ãƒ³ã®ã€Œé€²ã‚€ã€ãŒã€Œé€²ã‚ã€ã ã£ãŸ' },
            // 3. æˆ»ã‚‹->æˆ»ã‚Œ
            { desc: normalDescription, class: 'anomaly-back-imperative', hint: 'ãƒœã‚¿ãƒ³ã®ã€Œæˆ»ã‚‹ã€ãŒã€Œæˆ»ã‚Œã€ã ã£ãŸ' },
            // 4. å³ä¸‹ã«ãƒ‘ãƒ³ãƒ†ã‚£ãƒ¼
            { desc: normalDescription, class: 'anomaly-panties-br', hint: 'å³ä¸‹ã«ãƒ‘ãƒ³ãƒ†ã‚£ãƒ¼ãŒè½ã¡ã¦ã„ãŸ' },
            // 5. å·¦ä¸‹ã«ãƒˆãƒ©ãƒ³ã‚¯ã‚¹
            { desc: normalDescription, class: 'anomaly-trunks-bl', hint: 'å·¦ä¸‹ã«ãƒˆãƒ©ãƒ³ã‚¯ã‚¹ãŒè½ã¡ã¦ã„ãŸ' },
            // 6. å®‰å…¨ç¬¬ä¸€â†’å®‰å…¨å¼Ÿä¸€
            { desc: normalDescription, class: 'anomaly-poster-safety-brother', hint: 'ãƒã‚¹ã‚¿ãƒ¼ã®ã€Œå®‰å…¨ç¬¬ä¸€ã€ãŒã€Œå®‰å…¨å¼Ÿä¸€ã€ã ã£ãŸ' },
            // ãƒã‚¹ã‚¿ãƒ¼ã®ã€Œå®‰å…¨ç¬¬ä¸€ã€ãŒã€Œå®‰å…¨å®‰å¿ƒã€ã ã£ãŸ
            { desc: normalDescription, class: 'anomaly-poster-safety-anshin', hint: 'ãƒã‚¹ã‚¿ãƒ¼ã®ã€Œå®‰å…¨ç¬¬ä¸€ã€ãŒã€Œå®‰å…¨å®‰å¿ƒã€ã ã£ãŸ' },
            // 8. éå¸¸å£ãŒé«˜ã„
            { desc: normalDescription, class: 'anomaly-sign-higher', hint: 'éå¸¸å£ã®ä½ç½®ãŒå°‘ã—é«˜ã‹ã£ãŸ' },
            // 8b. éå¸¸å£ãŒä½ã„
            { desc: normalDescription, class: 'anomaly-sign-lower', hint: 'éå¸¸å£ã®ä½ç½®ãŒå°‘ã—ä½ã‹ã£ãŸ' },
            // 9. ãƒã‚¹ã‚¿ãƒ¼ãŒé«˜ã„
            { desc: normalDescription, class: 'anomaly-poster-higher', hint: 'ãƒã‚¹ã‚¿ãƒ¼ã®ä½ç½®ãŒå°‘ã—é«˜ã‹ã£ãŸ' },
            // 9b. ãƒã‚¹ã‚¿ãƒ¼ãŒä½ã„
            { desc: normalDescription, class: 'anomaly-poster-lower', hint: 'ãƒã‚¹ã‚¿ãƒ¼ã®ä½ç½®ãŒå°‘ã—ä½ã‹ã£ãŸ' },
            // 10. ã€Œã€œç•ªé€šè·¯ã€ã®è¡¨ç¤ºä½ç½®ãŒå°‘ã—ä½ã„
            { desc: normalDescription, class: 'anomaly-passage-title-lower', hint: 'ã€Œã€œç•ªé€šè·¯ã€ã®è¡¨ç¤ºä½ç½®ãŒå°‘ã—ä½ã‹ã£ãŸ' },
            // 11. å¤©äº•ãƒ©ã‚¤ãƒˆã®ãƒ–ãƒ©ãƒ¼åŠ¹æœãŒå°‘ã—å¤§ãã„
            { desc: normalDescription, class: 'anomaly-light-blur-stronger', hint: 'å¤©äº•ãƒ©ã‚¤ãƒˆã®å…‰ç·šãŒå¼·ã‹ã£ãŸ' },
            // 12. ã‚«ãƒ¼ã‚½ãƒ«ã‚’è¿‘ã¥ã‘ã‚‹ã¨ãƒœã‚¿ãƒ³ãŒé€ƒã’ã‚‹
            { desc: normalDescription, class: 'anomaly-buttons-avoid-cursor', hint: 'ã‚«ãƒ¼ã‚½ãƒ«ã«åç™ºã—ã¦ãƒœã‚¿ãƒ³ãŒå°‘ã—é€ƒã’ãŸ' },
            // 13. ã‚«ãƒ¼ã‚½ãƒ«ã®è‰²ãŒè–„ããªã‚‹
            { desc: normalDescription, class: 'anomaly-cursor-faint', hint: 'ã‚«ãƒ¼ã‚½ãƒ«ã®è‰²ãŒè–„ããªã£ã¦ã„ãŸ' },
            // 14. ç”»é¢å¤–ã«ã‚«ãƒ¼ã‚½ãƒ«ã§æš—ããªã‚‹
            { desc: normalDescription, class: 'anomaly-dim-on-leave', hint: 'ã‚²ãƒ¼ãƒ ç”»é¢å¤–ã«ã‚«ãƒ¼ã‚½ãƒ«ã§ç”»é¢ãŒæš—ããªã£ãŸ' },
            // 15. ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•ã§è–„ã„è»Œè·¡ãŒæ®‹ã‚‹
            { desc: normalDescription, class: 'anomaly-cursor-trail', hint: 'ã‚«ãƒ¼ã‚½ãƒ«ã®ç§»å‹•ã«è–„ã„è»Œè·¡ãŒæ®‹ã£ãŸ' },
            // 16. URLè¡¨ç¤ºæ¬„ã«ã€ŒãŒã‚“ã°ã‚Œãƒ¼ã€
            { desc: normalDescription, class: 'anomaly-url-ganbare', hint: 'URLã®è¡¨ç¤ºæ¬„ã«ã€ŒãŒã‚“ã°ã‚Œãƒ¼ã€ã¨è¡¨ç¤ºã•ã‚ŒãŸ' },
            // 17. ãƒ–ãƒ©ã‚¦ã‚¶å·¦ä¸Šã«ãƒãƒ¼ãƒˆ
            { desc: normalDescription, class: 'anomaly-body-heart-topleft', hint: 'ãƒ–ãƒ©ã‚¦ã‚¶ã®å·¦ä¸Šã«ãƒãƒ¼ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸ' },
            { desc: normalDescription, class: 'anomaly-body-diamond-topright', hint: 'ãƒ–ãƒ©ã‚¦ã‚¶ã®å³ä¸Šã«ãƒ€ã‚¤ãƒ¤ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-spade-bottomright', hint: 'ãƒ–ãƒ©ã‚¦ã‚¶ã®å³ä¸‹ã«ã‚¹ãƒšãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-body-club-bottomleft', hint: 'ãƒ–ãƒ©ã‚¦ã‚¶ã®å·¦ä¸‹ã«ã‚¯ãƒ©ãƒ–ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-hand', hint: 'åºŠã‹ã‚‰æ‰‹ãŒç”Ÿãˆã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-shadow-hand', hint: 'åºŠã‹ã‚‰å½±ã®æ‰‹ãŒæ¹§ãä¸ŠãŒã£ã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-bamboo', hint: 'åºŠã‹ã‚‰ãŸã‘ã®ã“ãŒç”Ÿãˆã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-mushroom', hint: 'åºŠã‹ã‚‰ãã®ã“ãŒç”Ÿãˆã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-grass', hint: 'åºŠã‹ã‚‰è‰ãŒç”Ÿãˆã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-floor-w', hint: 'åºŠã‹ã‚‰Wã®æ–‡å­—ãŒç”Ÿãˆã¦ã„ãŸ' },
            { desc: normalDescription, class: 'anomaly-buttons-logic-swapped', hint: 'é€²ã‚€ãƒœã‚¿ãƒ³ã¨æˆ»ã‚‹ãƒœã‚¿ãƒ³ã®æ–‡å­—ãŒé€†ã ã£ãŸ' }
        ];

        // Use crypto-backed randomness to avoid repetitive patterns across reloads
        function randomFloat() {
            try {
                if (window.crypto && window.crypto.getRandomValues) {
                    const u32 = new Uint32Array(1);
                    window.crypto.getRandomValues(u32);
                    // 0 <= x < 1
                    return u32[0] / 4294967296; // 2^32
                }
            } catch (_) { /* fallback below */ }
            return Math.random();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(randomFloat() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function getNextAnomaly() {
            if (shuffledAnomalies.length === 0) {
                shuffledAnomalies = [...anomalies];
                shuffleArray(shuffledAnomalies);
            }
            return shuffledAnomalies.pop();
        }

        // NOTE: Debug UI is initialized in initDebugMode() to avoid duplication.

        function initDebugMode() {
            if (isDebugEnabledFromURL()) {
                isDebugMode = true;
                debugToggleBtn.style.display = 'block';
                debugInfo.style.display = 'block';
                debugInfo.classList.add('active');

                // ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                debugToggleBtn.addEventListener('click', () => {
                    if (debugInfo.classList.contains('hidden')) {
                        debugInfo.classList.remove('hidden');
                        debugInfo.style.display = 'block';
                        debugToggleBtn.textContent = 'ãƒ‡ãƒãƒƒã‚°éè¡¨ç¤º';
                    } else {
                        debugInfo.classList.add('hidden');
                        debugInfo.style.display = 'none';
                        debugToggleBtn.textContent = 'ãƒ‡ãƒãƒƒã‚°è¡¨ç¤º';
                    }
                });

                console.log('Initializing debug mode...');

                // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ç”¨ã«å…ƒã®é…åˆ—ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜
                originalAnomalies = JSON.parse(JSON.stringify(anomalies));

                // ã™ã§ã«åˆæœŸåŒ–æ¸ˆã¿ãªã‚‰å†åˆæœŸåŒ–ã‚’é¿ã‘ã‚‹
                if (debugInfo.querySelector('#anomaly-selector')) {
                    updateDebugInfo();
                    return;
                }

                const selector = document.createElement('select');
                selector.id = 'anomaly-selector';
                selector.innerHTML = '<option value="-1">ç•°å¤‰ãªã—</option>';
                // é¸æŠã—ãŸæ™‚ç‚¹ã§å³é©ç”¨
                selector.addEventListener('change', () => {
                    const selectedIndex = parseInt(selector.value, 10);
                    forceSetAnomaly(selectedIndex);
                });

                // å…ƒã®é…åˆ—ã‚’ã‚½ãƒ¼ãƒˆç”¨ã«æº–å‚™
                const anomaliesWithIndex = originalAnomalies.map((anomaly, index) => ({
                    hint: anomaly.hint,
                    originalIndex: index,
                    anomaly: anomaly
                }));

                console.log('Total anomalies before sort:', anomaliesWithIndex.length);

                // ãƒ’ãƒ³ãƒˆã®å†…å®¹ã§ã‚½ãƒ¼ãƒˆ
                anomaliesWithIndex.sort((a, b) => a.hint.localeCompare(b.hint, 'ja'));

                // optionè¦ç´ ã‚’ä½œæˆï¼ˆå‡ºç¾æ•°ä»˜ãï¼‰
                function updateSelectorOptions() {
                    // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæœ€åˆã®ã€Œç•°å¤‰ãªã—ã€ä»¥å¤–ï¼‰ã‚’å‰Šé™¤
                    while (selector.options.length > 1) {
                        selector.remove(1);
                    }

                    // å„ç•°å¤‰ã®å‡ºç¾æ•°ã‚’å–å¾—ã—ã¦ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å†ä½œæˆ
                    anomaliesWithIndex.forEach((item, sortedIndex) => {
                        const option = document.createElement('option');
                        option.value = item.originalIndex;
                        const cls = item.anomaly.class || '(text-only)';
                        const count = anomalyCountByClass.get(cls) || 0;
                        option.textContent = `[${item.originalIndex}] ${item.hint} (${count}å›)`;
                        selector.appendChild(option);
                    });
                }

                // åˆå›ä½œæˆ
                updateSelectorOptions();

                // updateDebugInfoå®Ÿè¡Œæ™‚ã«ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚‚æ›´æ–°ã™ã‚‹ãŸã‚ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å‚ç…§ã‚’ä¿å­˜
                window.updateSelectorOptions = updateSelectorOptions;

                // è„±å‡ºæˆåŠŸã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤ºãƒœã‚¿ãƒ³
                const successBtn = document.createElement('button');
                successBtn.id = 'show-success-btn';
                successBtn.textContent = 'è„±å‡ºæˆåŠŸã‚’è¡¨ç¤º';
                successBtn.onclick = () => {
                    currentPassage = 8;
                    hasAnomaly = false;
                    clearGame();
                    fadeOverlay.classList.remove('is-active');
                };

                // ãƒ‡ãƒãƒƒã‚°ï¼šç•°å¤‰ã‚«ã‚¦ãƒ³ãƒˆã®ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
                const resetCountBtn = document.createElement('button');
                resetCountBtn.id = 'reset-counts-btn';
                resetCountBtn.textContent = 'ç•°å¤‰ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ';
                resetCountBtn.onclick = () => { resetAnomalyCounts(); updateDebugInfo(); };

                debugInfo.innerHTML = '<h3>--- DEBUG MODE ---</h3><p>Loading...</p>';
                debugInfo.appendChild(selector);
                debugInfo.appendChild(successBtn);
                debugInfo.appendChild(resetCountBtn);

                console.log('Debug mode initialized');
            }
        }

        function updateDebugInfo() {
            if (!isDebugMode) return;

            const successMessage = wrapper.querySelector('.success-message');
            if (successMessage) {
                debugInfo.innerHTML = `
                <h3>--- DEBUG MODE ---</h3>
                <b>GAME STATE:</b> CLEARED<br>
                <b>Final Passage:</b> ${currentPassage}
            `;
                return;
            }

            const hintText = hasAnomaly ? currentAnomaly.hint : 'ãªã—';
            const debugContent = `
            <h3>--- DEBUG MODE ---</h3>
            <b>Passage:</b> ${currentPassage}<br>
            <b>Anomaly Active:</b> ${hasAnomaly}<br>
            <b>Description:</b> ${hintText}<br>
            <b>Class:</b> ${currentAnomaly.class || 'ãªã—'}<br>
            <hr>
            <b>Picks Total:</b> ${anomalyPickTotal} / <b>Distinct Seen:</b> ${anomalyCountByClass.size}<br>
        `;

            const selector = debugInfo.querySelector('#anomaly-selector');
            const successBtn = debugInfo.querySelector('#show-success-btn');
            const resetCountBtn = debugInfo.querySelector('#reset-counts-btn');
            debugInfo.innerHTML = debugContent;
            if (selector) debugInfo.appendChild(selector);
            if (successBtn) debugInfo.appendChild(successBtn);
            if (resetCountBtn) debugInfo.appendChild(resetCountBtn);

            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®å‡ºç¾æ•°è¡¨ç¤ºã‚’æ›´æ–°
            if (window.updateSelectorOptions) {
                window.updateSelectorOptions();
            }
        }

        function resetVisuals() {
            // ç•°å¤‰ã®è§£é™¤æ™‚ã«ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã§å‹•ããŒå‡ºãªã„ã‚ˆã†ä¸€æ™‚çš„ã«æŠ‘æ­¢
            wrapper.classList.add('no-transition');
            bodyEl.classList.add('no-transition-filter');
            if (currentAnomaly.class) {
                wrapper.classList.remove(currentAnomaly.class);
                bodyEl.classList.remove(currentAnomaly.class);
            }

            description.style.color = '';
            passageTitle.style.color = '';
            wrapper.style.borderColor = '';
            wrapper.style.backgroundColor = '';
            wrapper.style.transform = '';
            wrapper.style.boxShadow = '';
            bodyEl.style.backgroundColor = '';
            bodyEl.style.filter = '';
            forwardButton.style.color = '';
            backButton.style.color = '';
            message.style.border = '';
            // reset button drift (for avoid-cursor anomaly)
            avoidCursorActive = false;
            resetButtonTransforms();
            // reset logic swap state
            buttonLogicSwapped = false;
            // reset dim-on-leave state
            dimOnLeaveActive = false;
            wrapper.classList.remove('is-dimmed');
            // reset cursor trail
            cursorTrailActive = false;
            wrapper.querySelectorAll('.cursor-trail-dot').forEach(el => el.remove());
            // reset URL bar text if we changed it
            if (urlGanbareActive) {
                history.replaceState(null, '', location.pathname + location.search + originalURLHash);
                urlGanbareActive = false;
            }
            // æ¬¡ãƒ•ãƒ¬ãƒ¼ãƒ ã§æŠ‘æ­¢ãƒ•ãƒ©ã‚°ã‚’è§£é™¤
            requestAnimationFrame(() => {
                // reflow ã‚’æŒŸã‚“ã§ç¢ºå®Ÿã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºå®š
                void wrapper.offsetHeight;
                wrapper.classList.remove('no-transition');
                bodyEl.classList.remove('no-transition-filter');
            });
        }

        function applyAnomaly(anomaly) {
            currentAnomaly = anomaly;
            description.innerHTML = currentAnomaly.desc;
            // ç•°å¤‰ã®é©ç”¨æ™‚ã‚‚ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã§å‹•ããŒå‡ºãªã„ã‚ˆã†ä¸€æ™‚çš„ã«æŠ‘æ­¢
            wrapper.classList.add('no-transition');
            bodyEl.classList.add('no-transition-filter');
            if (currentAnomaly.class) {
                if (currentAnomaly.class.startsWith('anomaly-body-')) {
                    bodyEl.classList.add(currentAnomaly.class);
                } else {
                    wrapper.classList.add(currentAnomaly.class);
                }
            }
            // Enable/disable logic swap based on anomaly
            buttonLogicSwapped = currentAnomaly.class === 'anomaly-buttons-logic-swapped';
            // Debug: record the pick when an anomaly is active
            if (hasAnomaly) {
                incAnomalyCount(currentAnomaly.class);
            }
            // Enable/disable cursor-avoid behavior dynamically
            avoidCursorActive = currentAnomaly.class === 'anomaly-buttons-avoid-cursor';
            if (!avoidCursorActive) resetButtonTransforms();
            // Enable dim-on-leave behavior dynamically
            dimOnLeaveActive = currentAnomaly.class === 'anomaly-dim-on-leave';
            if (!dimOnLeaveActive) wrapper.classList.remove('is-dimmed');
            // Enable cursor trail behavior dynamically
            cursorTrailActive = currentAnomaly.class === 'anomaly-cursor-trail';
            if (!cursorTrailActive) wrapper.querySelectorAll('.cursor-trail-dot').forEach(el => el.remove());
            // Enable URL bar change dynamically (use hash to avoid navigation)
            if (currentAnomaly.class === 'anomaly-url-ganbare') {
                urlGanbareActive = true;
                history.replaceState(null, '', location.pathname + location.search + '#ãŒã‚“ã°ã‚Œãƒ¼');
            } else if (urlGanbareActive) {
                history.replaceState(null, '', location.pathname + location.search + originalURLHash);
                urlGanbareActive = false;
            }
            // æ¬¡ãƒ•ãƒ¬ãƒ¼ãƒ ã§æŠ‘æ­¢ãƒ•ãƒ©ã‚°ã‚’è§£é™¤ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç³»ã®ç•°å¤‰ã¯CSSã®animationã§å‹•ããŸã‚å½±éŸ¿ãªã—ï¼‰
            requestAnimationFrame(() => {
                void wrapper.offsetHeight;
                wrapper.classList.remove('no-transition');
                bodyEl.classList.remove('no-transition-filter');
            });
        }

        function forceSetAnomaly(index) {
            resetVisuals();
            if (index === -1) {
                hasAnomaly = false;
                currentAnomaly = {};
                description.innerHTML = normalDescription;
            } else {
                hasAnomaly = true;
                const anomaly = anomalies[index];
                applyAnomaly(anomaly);
            }
            updateDebugInfo();
        }

        function setupNewPassage() {
            passageTitle.textContent = `${currentPassage >= 8 ? 8 : currentPassage}ç•ªé€šè·¯`;

            resetVisuals();

            currentAnomaly = {};
            // Clear transient message so '...' does not remain when nothing to show
            message.textContent = '';

            if (isFirstTurn) {
                hasAnomaly = false;
                isFirstTurn = false;
            } else if (randomFloat() < 0.70) {
                hasAnomaly = true;
            } else {
                hasAnomaly = false;
            }

            if (hasAnomaly) {
                applyAnomaly(getNextAnomaly());
            } else {
                description.innerHTML = normalDescription;
            }
            updateDebugInfo();

            // In normal mode, if a pending message exists when returning to 0, show the cause.
            if (!isHardMode && currentPassage === 0 && pendingReturnMessage) {
                message.textContent = pendingReturnMessage;
                pendingReturnMessage = '';
            }

            // In soft mode, after a correct detection on previous turn, show the anomaly content
            if (isSoftMode && currentPassage > 0 && pendingProceedMessage) {
                message.textContent = pendingProceedMessage;
                pendingProceedMessage = '';
            }
        }

        function processTurn(decision) {
            if (currentPassage >= 8 && !hasAnomaly && decision === false) {
                forwardButton.disabled = true;
                backButton.disabled = true;
                fadeOverlay.classList.add('is-active');
                setTimeout(() => {
                    clearGame();
                    // Reveal the success screen after fade
                    fadeOverlay.classList.remove('is-active');
                }, 1000);
                return;
            }

            const isCorrect = decision === hasAnomaly;

            forwardButton.disabled = true;
            backButton.disabled = true;
            fadeOverlay.classList.add('is-active');

            setTimeout(() => {
                if (isCorrect) {
                    // In soft mode, if an anomaly was correctly detected, carry over its content
                    if (isSoftMode && hasAnomaly && currentAnomaly && currentAnomaly.hint) {
                        pendingProceedMessage = `ç•°å¤‰: ${currentAnomaly.hint}`;
                    }
                    message.textContent = '...';
                    if (currentPassage < 8) {
                        currentPassage++;
                    }
                } else {
                    const msg = hasAnomaly
                        ? `ç•°å¤‰ã‚’è¦‹é€ƒã—ã¾ã—ãŸã€‚(å†…å®¹: ${currentAnomaly.hint})`
                        : "ç•°å¤‰ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
                    // In hard mode, show nothing when returning to 0.
                    // In normal mode, defer the cause message to display on the 0 passage.
                    pendingReturnMessage = isHardMode ? '' : `${msg} 0ç•ªé€šè·¯ã«æˆ»ã‚Šã¾ã™ã€‚`;
                    currentPassage = 0;
                    isFirstTurn = true;
                    shuffledAnomalies = [];
                }

                setupNewPassage();

                fadeOverlay.classList.remove('is-active');

                setTimeout(() => {
                    const successMessage = wrapper.querySelector('.success-message');
                    if (!successMessage) {
                        forwardButton.disabled = false;
                        backButton.disabled = false;
                    }
                }, 1000);

            }, 1000);
        }

        function clearGame() {
            wrapper.innerHTML = `
            <div class="exit-container">
                <div class="exit-light"></div>
                <div class="exit-floor"></div>
                <div class="stairs">
                    <div class="step"></div>
                    <div class="step"></div>
                    <div class="step"></div>
                    <div class="step"></div>
                    <div class="step"></div>
                </div>
                <div class="success-message">è„±å‡ºæˆåŠŸï¼</div>
            </div>
            <style>
                .exit-container {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: flex-end;
                    height: 300px;
                    position: relative;
                    background: radial-gradient(circle at 50% -40px, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.6) 55%, rgba(0,0,0,0.85) 100%);
                    overflow: hidden;
                }
                .exit-container::before{
                    content: '';
                    position: absolute;
                    inset: -60px;
                    background: radial-gradient(circle at 50% -40px, rgba(0,0,0,0) 28%, rgba(0,0,0,0.55) 62%, rgba(0,0,0,0.9) 95%);
                    z-index: 2; /* darken surroundings */
                    pointer-events: none;
                }
                .exit-light {
                    position: absolute;
                    top: -50px;
                    width: 400%;
                    height: 260px;
                    background:
                        radial-gradient(circle at 50% 10%, rgba(255,255,255,1) 0%, rgba(255,255,255,0.85) 14%, rgba(255,255,180,0.7) 26%, rgba(255,255,200,0.25) 46%, rgba(255,255,220,0.05) 70%, rgba(255,255,220,0) 80%),
                        radial-gradient(circle at 50% 10%, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0) 35%);
                    filter: blur(6px) brightness(1.25);
                    animation: glowPulse 2.2s ease-in-out infinite;
                    z-index: 1; /* behind overlay */
                }
                /* Foreground floor plane */
                .exit-floor {
                    position: absolute;
                    left: 50%;
                    bottom: -10px;
                    transform: translateX(-50%) perspective(700px) rotateX(58deg);
                    width: 320%;
                    height: 160px;
                    background:
                        linear-gradient(to bottom, rgba(255,255,255,0.95), rgba(238,238,238,0.9)),
                        repeating-linear-gradient(45deg, rgba(245,245,245,0.9) 0px, rgba(245,245,245,0.9) 10px, rgba(232,232,232,0.9) 10px, rgba(232,232,232,0.9) 20px);
                    box-shadow: 0 -8px 30px rgba(255,255,220,0.6) inset, 0 0 30px rgba(255,255,200,0.25);
                    z-index: 3; /* same layer as stairs, will render under by DOM order */
                }
                .stairs {
                    width: 150px;
                    height: 150px;
                    position: relative;
                    perspective: 400px;
                    z-index: 3; /* above vignette */
                    overflow: visible;
                }
                /* Soft glow spilling onto the steps */
                .stairs::before {
                    content: '';
                    position: absolute;
                    left: 50%;
                    top: -10px;
                    transform: translateX(-50%);
                    width: 200%;
                    height: 180%;
                    background: radial-gradient(ellipse at 50% -20px,
                        rgba(255,255,240,0.85) 0%,
                        rgba(255,255,210,0.55) 25%,
                        rgba(255,255,190,0.25) 48%,
                        rgba(255,255,180,0) 70%);
                    filter: blur(10px);
                    pointer-events: none;
                    z-index: 4;
                }
                /* Light rays across the stairs */
                .stairs::after {
                    content: '';
                    position: absolute;
                    left: 50%;
                    top: -20px;
                    transform: translateX(-50%) rotate(-8deg);
                    width: 260%;
                    height: 200%;
                    background:
                        repeating-linear-gradient(
                            to bottom,
                            rgba(255,255,220,0.35) 0px,
                            rgba(255,255,220,0.35) 6px,
                            rgba(255,255,220,0.0) 22px,
                            rgba(255,255,220,0.0) 32px
                        );
                    opacity: 0.8;
                    filter: blur(8px);
                    pointer-events: none;
                    z-index: 4;
                }
                .step {
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 100%;
                    height: 30px;
                    background: #f0f0f0;
                    border-top: 2px solid #ffffff;
                    transform-origin: bottom center;
                    box-shadow: inset 0 8px 18px rgba(255,255,240,0.25);
                }
                .step:nth-child(1) { transform: translateZ(0px) translateY(0px); }
                .step:nth-child(2) { transform: translateZ(-30px) translateY(-30px); }
                .step:nth-child(3) { transform: translateZ(-60px) translateY(-60px); }
                .step:nth-child(4) { transform: translateZ(-90px) translateY(-90px); }
                .step:nth-child(5) { transform: translateZ(-120px) translateY(-120px); }
                .success-message {
                    margin-top: 20px;
                    color: #ffffff;
                    font-size: 2.2em;
                    font-weight: 700;
                    -webkit-text-stroke: 1px rgba(0,0,0,0.55);
                    text-shadow:
                        0 1px 2px rgba(0,0,0,0.85),
                        0 2px 6px rgba(0,0,0,0.6),
                        0 0 8px rgba(255,255,200,0.85),
                        0 0 18px rgba(255,255,140,0.55);
                    animation: pulse 1.5s infinite alternate;
                    z-index: 5;
                }
                @keyframes pulse{from{transform:scale(1)}to{transform:scale(1.05)}}
                @keyframes glowPulse{0%{filter: blur(6px) brightness(1.15)}50%{filter: blur(7px) brightness(1.35)}100%{filter: blur(6px) brightness(1.15)}}
            </style>
        `;
            updateDebugInfo();
        }

        // When the logic-swapped anomaly is active, swap the decision mapping
        forwardButton.addEventListener('click', () => { processTurn(buttonLogicSwapped ? true : false); });
        backButton.addEventListener('click', () => { processTurn(buttonLogicSwapped ? false : true); });

        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ã®å®Ÿè£…
        function runSimulation() {
            const iterations = getSimIterationsFromURL();

            console.log('=== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ ===');
            console.log(`ç•°å¤‰ç·æ•°: ${anomalies.length}`);
            console.log(`ç¹°ã‚Šè¿”ã—å›æ•°: ${iterations}`);
            console.log('');

            // å„ç•°å¤‰ã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            const pickCounts = new Map();

            for (let i = 0; i < iterations; i++) {
                console.log(`--- ç¬¬${i + 1}å›ã‚·ãƒ£ãƒƒãƒ•ãƒ« ---`);

                // å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã¨åŒã˜æ–¹æ³•ã§ã‚·ãƒ£ãƒƒãƒ•ãƒ«
                const testArray = [...anomalies];
                shuffleArray(testArray);

                // æœ«å°¾10å€‹ã‚’å–å¾—
                const last10 = testArray.slice(-10);

                console.log('æœ«å°¾10å€‹:');
                last10.forEach((anomaly, idx) => {
                    const key = anomaly.hint;
                    const position = testArray.length - 10 + idx;
                    console.log(`  [${position}] ${key}`);

                    // ã‚«ã‚¦ãƒ³ãƒˆ
                    pickCounts.set(key, (pickCounts.get(key) || 0) + 1);
                });
                console.log('');
            }

            // çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
            console.log('=== çµ±è¨ˆçµæœ ===');
            console.log(`ç·ã‚·ãƒ£ãƒƒãƒ•ãƒ«å›æ•°: ${iterations}`);
            console.log(`æœ«å°¾10å€‹ Ã— ${iterations}å› = ${iterations * 10}å›ã®é¸æŠæ©Ÿä¼š`);
            console.log('');

            // å‡ºç¾å›æ•°ã§ã‚½ãƒ¼ãƒˆ
            const sortedCounts = Array.from(pickCounts.entries())
                .sort((a, b) => b[1] - a[1]);

            console.log('å„ç•°å¤‰ã®å‡ºç¾å›æ•°ï¼ˆé™é †ï¼‰:');
            sortedCounts.forEach(([hint, count]) => {
                const percentage = ((count / (iterations * 10)) * 100).toFixed(2);
                console.log(`  ${count}å› (${percentage}%): ${hint}`);
            });
            console.log('');

            // ç†è«–å€¤ã¨ã®æ¯”è¼ƒ
            const expectedCount = (iterations * 10) / anomalies.length;
            const expectedPercentage = ((10 / anomalies.length) * 100).toFixed(2);
            console.log(`ç†è«–ä¸Šã®æœŸå¾…å€¤: ${expectedCount.toFixed(2)}å› (${expectedPercentage}%)`);
            console.log('');

            // åã‚Šã®æ¤œå‡º
            const maxCount = sortedCounts[0][1];
            const minCount = sortedCounts[sortedCounts.length - 1][1];
            const variance = maxCount - minCount;
            console.log(`æœ€å¤§å‡ºç¾å›æ•°: ${maxCount}å›`);
            console.log(`æœ€å°å‡ºç¾å›æ•°: ${minCount}å›`);
            console.log(`åˆ†æ•£: ${variance}å›`);
            console.log('');

            // å‡ºç¾å›æ•°0ã®ç•°å¤‰
            const neverPicked = anomalies.filter(a => !pickCounts.has(a.hint));
            if (neverPicked.length > 0) {
                console.log(`å‡ºç¾ã—ãªã‹ã£ãŸç•°å¤‰: ${neverPicked.length}å€‹`);
                neverPicked.forEach(a => {
                    console.log(`  - ${a.hint}`);
                });
            } else {
                console.log('å…¨ã¦ã®ç•°å¤‰ãŒå°‘ãªãã¨ã‚‚1å›ã¯å‡ºç¾ã—ã¾ã—ãŸ');
            }

            console.log('');
            console.log('=== ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº† ===');

            // ç”»é¢ã«çµæœã‚’è¡¨ç¤º
            wrapper.innerHTML = `
                <div style="padding: 20px; text-align: left; font-family: monospace; font-size: 14px; max-height: 80vh; overflow-y: auto;">
                    <h2 style="text-align: center; color: #e53935;">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº†</h2>
                    <p><strong>ç·ã‚·ãƒ£ãƒƒãƒ•ãƒ«å›æ•°:</strong> ${iterations}å›</p>
                    <p><strong>ç·é¸æŠæ©Ÿä¼š:</strong> ${iterations * 10}å›</p>
                    <p><strong>ç†è«–ä¸Šã®æœŸå¾…å€¤:</strong> ${expectedCount.toFixed(2)}å› (${expectedPercentage}%)</p>
                    <p><strong>æœ€å¤§å‡ºç¾å›æ•°:</strong> ${maxCount}å› (æœ€é »: ${sortedCounts[0][0]})</p>
                    <p><strong>æœ€å°å‡ºç¾å›æ•°:</strong> ${minCount}å›</p>
                    <p><strong>åˆ†æ•£:</strong> ${variance}å›</p>
                    <p><strong>å‡ºç¾ã—ãªã‹ã£ãŸç•°å¤‰:</strong> ${neverPicked.length}å€‹</p>
                    <hr>
                    <p style="color: #ffd700;">è©³ç´°ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
                </div>
            `;
        }

        initDebugMode();
        // Initialize hard/soft mode from URL
        isHardMode = isHardModeEnabledFromURL();
        isSoftMode = isSoftModeEnabledFromURL();

        // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¢ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
        if (isSimModeEnabledFromURL()) {
            runSimulation();
        } else {
            // NOTE: Do not shuffle the master `anomalies` array.
            // Random selection uses `shuffledAnomalies` built from a copy in getNextAnomaly().
            // Shuffling here breaks debug dropdown indices.
            setupNewPassage();
        }
    </script>

</body>

</html>